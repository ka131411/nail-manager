import streamlit as st
import requests
import json

# 1. í˜ì´ì§€ ì„¤ì •
st.set_page_config(page_title="ë„¤ì¼ ë§¤ë‹ˆì € AI", page_icon="ğŸ’…")
st.title("ğŸ’… ë„¤ì¼ìƒµ ì›ì¥ë‹˜ ì „ìš© AI ë¹„ì„œ")
st.caption("ì‚¬ì¥ë‹˜ì„ ìœ„í•´ ì œê°€ ë¯¸ë¦¬ ê²°ì œí•´ë’€ì–´ìš”! ë¬´ë£Œë¡œ ë§˜ê» ì“°ì„¸ìš”. ğŸ")

# 2. ë¹„ë°€ ê¸ˆê³ ì—ì„œ í‚¤ ê°€ì ¸ì˜¤ê¸° (ì˜¤ë¥˜ ë°©ì§€)
try:
    api_key = st.secrets["GOOGLE_API_KEY"]
except:
    # í˜¹ì‹œ í‚¤ ì„¤ì •ì´ ì•ˆ ë˜ì–´ìˆì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ ì…ë ¥ì°½ì„ ë„ì›Œì¤Œ
    with st.sidebar:
        api_key = st.text_input("API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”.", type="password")

# 3. ì…ë ¥ í™”ë©´
col1, col2 = st.columns(2)
with col1:
    keywords = st.text_area("ë””ìì¸ í‚¤ì›Œë“œ", placeholder="ì˜ˆ: ìì„ì ¤, ê²¨ìš¸ì™•êµ­, ì›¨ë”©ë„¤ì¼")
with col2:
    points = st.text_area("ê°•ì¡°í•  ì ", placeholder="ì˜ˆ: ìœ ì§€ë ¥ ê¹¡íŒ¨, ì‹¤ë¬¼ ê°‘, ì´ë‹¬ì˜ ì•„íŠ¸")

# 4. AI ìƒì„± ë¡œì§
if st.button("ì¸ìŠ¤íƒ€ ê¸€ ìƒì„±í•˜ê¸° âœ¨", type="primary"):
    if not keywords:
        st.warning("ì–´ë–¤ ë””ìì¸ì¸ì§€ í‚¤ì›Œë“œëŠ” ì•Œë ¤ì£¼ì„¸ìš”!")
    else:
        # 4-1. ì—¬ê¸°ê°€ í•µì‹¬! AIì—ê²Œ 'ì—°ê¸° ì§€ë„'ë¥¼ ì‹œí‚µë‹ˆë‹¤.
        prompt = f"""
        ë‹¹ì‹ ì€ ì¸ìŠ¤íƒ€ê·¸ë¨ì—ì„œ ì†Œí†µ ì˜í•˜ê¸°ë¡œ ìœ ëª…í•œ 'ê°ì„± ë„¤ì¼ìƒµ ì›ì¥ë‹˜'ì…ë‹ˆë‹¤.
        ì•„ë˜ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì¸ìŠ¤íƒ€ê·¸ë¨ í”¼ë“œ ê¸€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.
        
        [ì •ë³´]
        - ë””ìì¸: {keywords}
        - íŠ¹ì§•: {points}
        
        [ë§íˆ¬ ê°€ì´ë“œ - ì•„ì£¼ ì¤‘ìš”!]
        1. ê¸°ê³„ì ì¸ ë§íˆ¬(~í•©ë‹ˆë‹¤, ~ìŠµë‹ˆë‹¤) ì ˆëŒ€ ê¸ˆì§€! âŒ
        2. ì¹œí•œ ì–¸ë‹ˆë‚˜ ë™ìƒì—ê²Œ ë§í•˜ë“¯ ë¶€ë“œëŸ¬ìš´ 'í•´ìš”ì²´'(~ì—ìš”, ~í–ˆì–´ìš”)ë¥¼ ì“°ì„¸ìš”. â­•
        3. ë¬¸ì¥ ì‚¬ì´ì‚¬ì´ì— ì´ëª¨ì§€(âœ¨, ğŸ’…, ğŸ’–, ğŸ¥º)ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ì„ì–´ì£¼ì„¸ìš”.
        4. ê°íƒ„ì‚¬(ì™€.., ì§„ì§œ, ëŒ€ë°•)ë¥¼ ì ì ˆíˆ ì¨ì„œ 'ì°' í›„ê¸°ì²˜ëŸ¼ ë³´ì´ê²Œ í•˜ì„¸ìš”.
        
        [ì‘ì„± ì–‘ì‹]
        - ì²« ì¤„: ì‹œì„ ì„ ë„ëŠ” ê°ì„± ì œëª©
        - ë³¸ë¬¸: ê³µë°± í¬í•¨ 3~4ì¤„ (ê°€ë…ì„± ì¢‹ê²Œ ì¤„ë°”ê¿ˆ í•„ìˆ˜)
        - ë§ˆë¬´ë¦¬: ì˜ˆì•½ ë¬¸ì˜ ìœ ë„ (DM, í”„ë¡œí•„ ë§í¬ ë“±)
        - í•´ì‹œíƒœê·¸: ìœ ì… ì˜ë˜ëŠ” íƒœê·¸ 5~7ê°œ
        """

        # 4-2. êµ¬ê¸€ ì„œë²„ë¡œ ì „ì†¡
        url = f"https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key={api_key}"
        headers = {'Content-Type': 'application/json'}
        data = {
            "contents": [{
                "parts": [{
                    "text": prompt
                }]
            }]
        }
        
        with st.spinner("AIê°€ ê°ì„± ì¶©ì „ ì¤‘ì…ë‹ˆë‹¤... ğŸ’–"):
            try:
                response = requests.post(url, headers=headers, json=data)
                
                if response.status_code == 200:
                    result = response.json()
                    text = result['candidates'][0]['content']['parts'][0]['text']
                    
                    st.success("ì‘ì„± ì™„ë£Œ! ì˜¤ë¥¸ìª½ ìœ„ ì•„ì´ì½˜ì„ ëˆŒëŸ¬ ë³µì‚¬í•˜ì„¸ìš” ğŸ‘‡")
                    
                    # â˜… ì—¬ê¸°ê°€ ë³µì‚¬ ë²„íŠ¼ ë§Œë“œëŠ” ë¹„ë²•ì…ë‹ˆë‹¤!
                    st.code(text, language=None) 
                    
                else:
                    st.error("ì ì‹œ ì˜¤ë¥˜ê°€ ë‚¬ì–´ìš”. ë‹¤ì‹œ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!")
            except Exception as e:
                st.error(f"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")
